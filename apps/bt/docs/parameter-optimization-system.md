# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…è¨ˆç”»

## æ¦‚è¦

æˆ¦ç•¥ã®ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è‡ªå‹•æœ€é©åŒ–ã—ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãª3Då¯è¦–åŒ–HTMLã‚’ç”Ÿæˆã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

**è¨­è¨ˆæ–¹é‡**:
- âœ… **æ—¢å­˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Œå…¨ä¿æŒ**: YAMLå®Œå…¨åˆ¶å¾¡ãƒ»SignalParamsæ§‹é€ ã‚’ä¸€åˆ‡å¤‰æ›´ã—ãªã„
- âœ… **YAMLå½¢å¼ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒªãƒƒãƒ‰å®šç¾©**: å†åˆ©ç”¨æ€§ãƒ»ç®¡ç†æ€§é‡è¦–
- âœ… **æ—¢å­˜default.yamlæ´»ç”¨**: æ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸è¦ãƒ»å…±é€šè¨­å®šã‚’ç¶™æ‰¿
- âœ… **CLIä¸¦åˆ—å‡¦ç†**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—å‡ºåŠ›ãƒ»é«˜é€ŸåŒ–
- âœ… **ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–å¯è¦–åŒ–**: 3Dæ•£å¸ƒå›³ãƒ»ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ç­‰ã‚’å«ã‚€HTMLè‡ªå‹•ç”Ÿæˆ

---

## ã‚·ã‚¹ãƒ†ãƒ ãƒ•ãƒ­ãƒ¼

```
1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒªãƒƒãƒ‰å®šç¾©ï¼ˆYAMLï¼‰
   â†“
2. CLIä¸¦åˆ—æœ€é©åŒ–å®Ÿè¡Œ
   â”œâ”€ ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLèª­ã¿è¾¼ã¿ï¼ˆã‚·ã‚°ãƒŠãƒ«æœ‰åŠ¹åŒ–ãƒ»å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
   â”œâ”€ ã‚°ãƒªãƒƒãƒ‰YAMLãƒãƒ¼ã‚¸ï¼ˆæœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ä¸Šæ›¸ãï¼‰
   â”œâ”€ SignalParamså‹•çš„æ§‹ç¯‰ï¼ˆãƒ™ãƒ¼ã‚¹è¨­å®š + æœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
   â”œâ”€ ä¸¦åˆ—ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
   â”‚  â”œâ”€ åˆå›ç­‰åˆ†é…ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆå…¨éŠ˜æŸ„å‡ç­‰é…åˆ†ï¼‰
   â”‚  â”œâ”€ KellyåŸºæº–è³‡é‡‘é…åˆ†è¨ˆç®—
   â”‚  â””â”€ Kellyé…åˆ†ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆæœ€çµ‚è©•ä¾¡ï¼‰
   â””â”€ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€²æ—å‡ºåŠ›
   â†“
3. æœ€é©åŒ–çµæœHTMLç”Ÿæˆ
   â”œâ”€ è¤‡åˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ãƒ©ãƒ³ã‚­ãƒ³ã‚°é †ã‚½ãƒ¼ãƒˆ
   â”œâ”€ 3Då¯è¦–åŒ–HTMLè‡ªå‹•ç”Ÿæˆ
   â””â”€ ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–åˆ†æç’°å¢ƒ
```

---

## 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒªãƒƒãƒ‰å®šç¾©ï¼ˆYAMLå½¢å¼ï¼‰

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
config/
â””â”€â”€ optimization/
    â”œâ”€â”€ template_grid.yaml  # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    â”œâ”€â”€ range_break_v6_grid.yaml
    â”œâ”€â”€ sma_cross_grid.yaml
    â””â”€â”€ bnf_mean_reversion_grid.yaml
```

### YAMLå½¢å¼ä»•æ§˜

**è¨­è¨ˆæ€æƒ³**:
- **æœ€å°é™ã®è¨˜è¿°**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¯„å›²ã®ã¿è¨˜è¿°
- **è‡ªå‹•æ¨æ¸¬**: ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æˆ¦ç•¥åãƒ»ãƒ™ãƒ¼ã‚¹è¨­å®šã‚’è‡ªå‹•æ¨æ¸¬ï¼ˆ`range_break_v6_grid.yaml` â†’ `range_break_v6.yaml`ï¼‰
- **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ´»ç”¨**: æœ€é©åŒ–è¨­å®šãƒ»å…±é€šè¨­å®šã¯default.yamlã‹ã‚‰èª­ã¿è¾¼ã¿
- **è¦ç´„ãƒ™ãƒ¼ã‚¹å‡ºåŠ›**: çµæœãƒ•ã‚¡ã‚¤ãƒ«ã¯æˆ¦ç•¥åã‹ã‚‰è‡ªå‹•ç”Ÿæˆ

#### è¨­è¨ˆåŸå‰‡: æˆ¦ç•¥YAML vs ã‚°ãƒªãƒƒãƒ‰YAMLã®è²¬ä»»åˆ†é›¢

**æˆ¦ç•¥YAML (`config/strategies/experimental/range_break_v6.yaml`) ã®å½¹å‰²**:
- âœ… ã‚·ã‚°ãƒŠãƒ«ã®æœ‰åŠ¹åŒ–ï¼ˆ`enabled: true/false`ï¼‰
- âœ… ã‚·ã‚°ãƒŠãƒ«ã®æ–¹å‘ãƒ»æ¡ä»¶ï¼ˆ`direction: "high"`, `condition: "break"`ï¼‰
- âœ… å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæœ€é©åŒ–ã—ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
- âœ… æˆ¦ç•¥ã®åŸºæœ¬æ§‹é€ ãƒ»ãƒ­ã‚¸ãƒƒã‚¯

**ã‚°ãƒªãƒƒãƒ‰YAML (`config/optimization/range_break_v6_grid.yaml`) ã®å½¹å‰²**:
- âœ… **æœ€é©åŒ–å¯¾è±¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç¯„å›²ã®ã¿**
- âœ… `parameter_ranges`é…ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å€¤ãƒªã‚¹ãƒˆ

**çµ±åˆãƒ«ãƒ¼ãƒ«**:
1. ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLã‚’èª­ã¿è¾¼ã¿ï¼ˆå…¨ã‚·ã‚°ãƒŠãƒ«è¨­å®šï¼‰
2. ã‚°ãƒªãƒƒãƒ‰YAMLã§æŒ‡å®šã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**ã®ã¿**ä¸Šæ›¸ã
3. ãã®ä»–ã®è¨­å®šï¼ˆ`enabled`, `direction`, `condition`ç­‰ï¼‰ã¯ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLã‹ã‚‰ç¶™æ‰¿

**ä¾‹**: ãƒ¬ãƒ³ã‚¸ãƒ–ãƒ¬ã‚¤ã‚¯æˆ¦ç•¥ã®å ´åˆ
```yaml
# config/strategies/experimental/range_break_v6.yamlï¼ˆãƒ™ãƒ¼ã‚¹æˆ¦ç•¥ï¼‰
entry_filter_params:
  period_breakout:
    enabled: true        # â† æˆ¦ç•¥YAMLã§ç®¡ç†
    direction: "high"    # â† æˆ¦ç•¥YAMLã§ç®¡ç†
    condition: "break"   # â† æˆ¦ç•¥YAMLã§ç®¡ç†
    lookback_days: 10    # â† ã‚°ãƒªãƒƒãƒ‰YAMLã§æœ€é©åŒ–
    period: 100          # â† ã‚°ãƒªãƒƒãƒ‰YAMLã§æœ€é©åŒ–

  volume:
    enabled: true        # â† æˆ¦ç•¥YAMLã§ç®¡ç†
    direction: "surge"   # â† æˆ¦ç•¥YAMLã§ç®¡ç†
    threshold: 2.0       # â† ã‚°ãƒªãƒƒãƒ‰YAMLã§æœ€é©åŒ–
```

```yaml
# config/optimization/range_break_v6_grid.yamlï¼ˆæœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ï¼‰
parameter_ranges:
  entry_filter_params:
    period_breakout:
      lookback_days: [5, 10, 15, 20]  # æœ€é©åŒ–å¯¾è±¡
      period: [30, 50, 100, 200]      # æœ€é©åŒ–å¯¾è±¡

    volume:
      threshold: [1.5, 2.0, 2.5, 3.0]  # æœ€é©åŒ–å¯¾è±¡
```

```yaml
# config/optimization/range_break_v6_grid.yaml

description: "ãƒ¬ãƒ³ã‚¸ãƒ–ãƒ¬ã‚¤ã‚¯v6æˆ¦ç•¥ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ã‚°ãƒªãƒƒãƒ‰"  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³

# ===== æœ€é©åŒ–ã™ã‚‹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¯„å›² =====
parameter_ranges:
  # entry_filter_paramsé…ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  entry_filter_params:

    # Period Breakoutã‚·ã‚°ãƒŠãƒ«
    period_breakout:
      lookback_days: [5, 10, 15, 20]  # çŸ­æœŸæœ€é«˜å€¤æœŸé–“
      period: [30, 50, 100, 200]      # é•·æœŸæœ€é«˜å€¤æœŸé–“

    # Bollinger Bandsã‚·ã‚°ãƒŠãƒ«
    bollinger_bands:
      window: [10, 20, 30]  # BBæœŸé–“
      alpha: [1.0, 1.5, 2.0]  # æ¨™æº–åå·®å€ç‡

    # Volumeã‚·ã‚°ãƒŠãƒ«
    volume:
      threshold: [1.5, 2.0, 2.5, 3.0]  # å‡ºæ¥é«˜å€ç‡
      short_period: [10, 20]  # çŸ­æœŸå¹³å‡æœŸé–“
      long_period: [50, 100]  # é•·æœŸå¹³å‡æœŸé–“

  # exit_trigger_paramsé…ä¸‹ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
  exit_trigger_params:

    # ATR Support Breakã‚·ã‚°ãƒŠãƒ«
    atr_support_break:
      lookback_period: [10, 20, 30]  # ã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ³æœŸé–“
      atr_multiplier: [2.0, 2.5, 3.0]  # ATRå€ç‡
```

**è‡ªå‹•æ¨æ¸¬ã•ã‚Œã‚‹è¨­å®š**:
- **ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAML**: `config/strategies/experimental/range_break_v6.yaml`ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ï¼‰
- **æœ€é©åŒ–è¨­å®š**: `config/default.yaml`ã®`parameter_optimization`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰èª­ã¿è¾¼ã¿
- **å…±é€šè¨­å®š**: `config/default.yaml`ã®`shared_config`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰èª­ã¿è¾¼ã¿
- **å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«** (æˆ¦ç•¥åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª + ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—):
  - å¯è¦–åŒ–HTML: `~/.local/share/trading25/backtest/optimization/range_break_v6/20250112_143052.html`


### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```yaml
# config/optimization/your_strategy_grid.yaml

description: "æˆ¦ç•¥ã®èª¬æ˜"  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³

parameter_ranges:
  entry_filter_params:
    # your_signal:
    #   param1: [value1, value2, value3]
    #   param2: [value1, value2]

  exit_trigger_params:
    # your_signal:
    #   param1: [value1, value2]
```

**æ³¨æ„**:
- ãƒ•ã‚¡ã‚¤ãƒ«åã‚’`{æˆ¦ç•¥å}_grid.yaml`ã®å½¢å¼ã«ã™ã‚‹ã“ã¨ã§ã€è‡ªå‹•çš„ã«æˆ¦ç•¥è¨­å®šãŒæ¨æ¸¬ã•ã‚Œã¾ã™
- æœ€é©åŒ–è¨­å®šï¼ˆmethod, n_jobs, scoring_weightsç­‰ï¼‰ã¯`config/default.yaml`ã§ç®¡ç†
- å¯è¦–åŒ–HTMLã¯`~/.local/share/trading25/backtest/optimization/{æˆ¦ç•¥å}/`ã«è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãï¼‰
- ç”Ÿæˆã•ã‚ŒãŸHTMLã«ã¯3Dæ•£å¸ƒå›³ã€ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç›¸é–¢ç­‰ãŒå«ã¾ã‚Œã¾ã™

---

## 2. CLIä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

åŒå(*_grid)ã®æˆ¦ç•¥ã‚’config/optimization/ã‹ã‚‰æ¤œç´¢

```bash
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–å®Ÿè¡Œ
uv run bt optimize range_break_v6 \
```

### å®Ÿè¡Œæ™‚ã®å‡ºåŠ›ä¾‹

```
ğŸš€ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–é–‹å§‹
æˆ¦ç•¥: range_break_v6
çµ„ã¿åˆã‚ã›æ•°: 96
ä¸¦åˆ—å‡¦ç†æ•°: 4

[1/96] lb=5, period=30, bb_win=10, vol_th=1.5: Sharpe=1.23, Calmar=0.89, Return=45.2%, Score=1.12
[2/96] lb=5, period=30, bb_win=10, vol_th=2.0: Sharpe=1.45, Calmar=1.02, Return=52.1%, Score=1.32
[3/96] lb=5, period=30, bb_win=10, vol_th=2.5: Sharpe=1.31, Calmar=0.95, Return=48.7%, Score=1.19
...
[96/96] lb=20, period=200, bb_win=30, vol_th=3.0: Sharpe=0.87, Calmar=0.65, Return=28.3%, Score=0.78

âœ… æœ€é©åŒ–å®Œäº†!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æœ€é©åŒ–çµæœï¼ˆè¤‡åˆã‚¹ã‚³ã‚¢ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸Šä½10ä»¶ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¥‡ Rank 1 - è¤‡åˆã‚¹ã‚³ã‚¢: 1.65
  entry_filter_params.period_breakout.lookback_days: 10
  entry_filter_params.period_breakout.period: 100
  entry_filter_params.bollinger_bands.window: 20
  entry_filter_params.volume.threshold: 2.0
  â†’ Sharpe: 1.87, Calmar: 1.35, Return: 68.5%

ğŸ¥ˆ Rank 2 - è¤‡åˆã‚¹ã‚³ã‚¢: 1.58
  entry_filter_params.period_breakout.lookback_days: 10
  entry_filter_params.period_breakout.period: 100
  entry_filter_params.bollinger_bands.window: 30
  entry_filter_params.volume.threshold: 2.0
  â†’ Sharpe: 1.79, Calmar: 1.28, Return: 65.3%

ğŸ¥‰ Rank 3 - è¤‡åˆã‚¹ã‚³ã‚¢: 1.52
  entry_filter_params.period_breakout.lookback_days: 15
  entry_filter_params.period_breakout.period: 100
  entry_filter_params.bollinger_bands.window: 20
  entry_filter_params.volume.threshold: 2.5
  â†’ Sharpe: 1.72, Calmar: 1.22, Return: 62.1%

...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š å¯è¦–åŒ–HTMLç”Ÿæˆä¸­...

âœ… å¯è¦–åŒ–HTMLç”Ÿæˆå®Œäº†!
  ğŸ““ ~/.local/share/trading25/backtest/optimization/range_break_v6/20250112_143052.html

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:
  open ~/.local/share/trading25/backtest/optimization/range_break_v6/20250112_143052.html
```

## 3. å®Ÿè£…è©³ç´°

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/
â”œâ”€â”€ cli/
â”‚   â””â”€â”€ optimize.py  # æ–°è¦CLIã‚³ãƒãƒ³ãƒ‰
â”œâ”€â”€ optimization/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ engine.py  # æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”œâ”€â”€ param_builder.py  # SignalParamså‹•çš„æ§‹ç¯‰
â”‚   â”œâ”€â”€ evaluator.py  # è©•ä¾¡æŒ‡æ¨™è¨ˆç®—
â”‚   â””â”€â”€ notebook_generator.py  # å¯è¦–åŒ–HTMLè‡ªå‹•ç”Ÿæˆ
config/
â””â”€â”€ optimization/  # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒªãƒƒãƒ‰å®šç¾©ï¼ˆæ–°è¦ï¼‰
    â”œâ”€â”€ template_grid.yaml
    â”œâ”€â”€ range_break_v6_grid.yaml
    â”œâ”€â”€ sma_cross_grid.yaml
    â””â”€â”€ bnf_mean_reversion_grid.yaml
docs/
â””â”€â”€ parameter-optimization-system.md  # ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

### ä¸»è¦ã‚¯ãƒ©ã‚¹è¨­è¨ˆ

#### ParameterOptimizerï¼ˆæœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰

```python
# src/optimization/engine.py

class ParameterOptimizer:
    """
    ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³

    YAMLã‚°ãƒªãƒƒãƒ‰å®šç¾©ã«åŸºã¥ãã€ä¸¦åˆ—æœ€é©åŒ–ã‚’å®Ÿè¡Œ
    """

    def __init__(self, strategy_name: str, grid_config_path: str):
        """
        Args:
            strategy_name: æˆ¦ç•¥åï¼ˆä¾‹: "range_break_v6"ï¼‰
            grid_config_path: ã‚°ãƒªãƒƒãƒ‰YAMLãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        """
        self.strategy_name = strategy_name

        # ã‚°ãƒªãƒƒãƒ‰YAMLèª­ã¿è¾¼ã¿
        with open(grid_config_path) as f:
            grid_config = yaml.safe_load(f)

        self.parameter_ranges = grid_config["parameter_ranges"]
        self.description = grid_config.get("description", "")

        # default.yamlèª­ã¿è¾¼ã¿
        default_config = self._load_default_config()

        # æœ€é©åŒ–è¨­å®š
        self.optimization = default_config["parameter_optimization"]

        # å…±é€šè¨­å®š
        self.shared_config = default_config["shared_config"]

        # ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLï¼ˆã‚°ãƒªãƒƒãƒ‰ã§æŒ‡å®š or ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ¨æ¸¬ï¼‰
        self.base_config_path = grid_config.get(
            "base_config",
            self._infer_base_config_path(strategy_name)
        )

        # ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLèª­ã¿è¾¼ã¿ï¼ˆã‚·ã‚°ãƒŠãƒ«æœ‰åŠ¹åŒ–ãƒ»å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
        with open(self.base_config_path) as f:
            base_strategy_config = yaml.safe_load(f)

        # ãƒ™ãƒ¼ã‚¹SignalParamsã‚’æ§‹ç¯‰ï¼ˆæœ€é©åŒ–ã—ãªã„è¨­å®šã®åŸºæº–å€¤ï¼‰
        self.base_entry_params = SignalParams(
            **base_strategy_config.get("entry_filter_params", {})
        )
        self.base_exit_params = SignalParams(
            **base_strategy_config.get("exit_trigger_params", {})
        )

        # å‡ºåŠ›HTMLãƒ‘ã‚¹ï¼ˆè¦ç´„ãƒ™ãƒ¼ã‚¹è‡ªå‹•ç”Ÿæˆï¼‰
        self.output_html_path = self._generate_html_path(strategy_name)

    def optimize(self) -> OptimizationResult:
        """
        æœ€é©åŒ–å®Ÿè¡Œ

        Returns:
            OptimizationResult: æœ€é©åŒ–çµæœ
        """
        # 1. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµ„ã¿åˆã‚ã›ç”Ÿæˆ
        combinations = self._generate_combinations()

        # 2. ä¸¦åˆ—æœ€é©åŒ–å®Ÿè¡Œ
        results = self._run_parallel_optimization(combinations)

        # 3. è¤‡åˆã‚¹ã‚³ã‚¢ãƒ©ãƒ³ã‚­ãƒ³ã‚°é †ã«ã‚½ãƒ¼ãƒˆ
        sorted_results = sorted(
            results,
            key=lambda x: x["score"],
            reverse=True  # é™é †ï¼ˆã‚¹ã‚³ã‚¢é«˜ã„é †ï¼‰
        )

        # 4. å¯è¦–åŒ–HTMLç”Ÿæˆ
        html_path = self._generate_visualization_notebook(sorted_results)

        return OptimizationResult(
            best_params=sorted_results[0]["params"],
            best_score=sorted_results[0]["score"],
            all_results=sorted_results,
            html_path=html_path
        )

    def _load_default_config(self) -> Dict:
        """
        default.yamlã‹ã‚‰è¨­å®šèª­ã¿è¾¼ã¿

        Returns:
            Dict: {
                "parameter_optimization": {...},
                "shared_config": {...}
            }
        """
        with open("config/default.yaml") as f:
            config = yaml.safe_load(f)

        return {
            "parameter_optimization": config["default"]["parameters"]["shared_config"]["parameter_optimization"],
            "shared_config": config["default"]["parameters"]["shared_config"]
        }

    def _infer_base_config_path(self, strategy_name: str) -> str:
        """
        æˆ¦ç•¥åã‹ã‚‰ãƒ™ãƒ¼ã‚¹è¨­å®šYAMLãƒ‘ã‚¹ã‚’æ¨æ¸¬

        Args:
            strategy_name: æˆ¦ç•¥åï¼ˆä¾‹: "range_break_v6"ï¼‰

        Returns:
            str: ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLãƒ‘ã‚¹

        æ¨æ¸¬ãƒ«ãƒ¼ãƒ«:
            1. config/strategies/experimental/{strategy_name}.yaml
            2. config/strategies/production/{strategy_name}.yaml
            3. è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼
        """
        candidates = [
            f"config/strategies/experimental/{strategy_name}.yaml",
            f"config/strategies/production/{strategy_name}.yaml"
        ]

        for path in candidates:
            if os.path.exists(path):
                return path

        raise FileNotFoundError(
            f"Base config not found for strategy '{strategy_name}'. "
            f"Searched: {candidates}"
        )

    def _generate_html_path(self, strategy_name: str) -> str:
        """
        æˆ¦ç•¥åã‹ã‚‰å¯è¦–åŒ–HTMLãƒ‘ã‚¹ã‚’ç”Ÿæˆï¼ˆæˆ¦ç•¥åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª + ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰

        Args:
            strategy_name: æˆ¦ç•¥å

        Returns:
            str: å¯è¦–åŒ–HTMLã®ãƒ‘ã‚¹

        å‡ºåŠ›å½¢å¼:
            ~/.local/share/trading25/backtest/optimization/{strategy_name}/{timestamp}.html

        ä¾‹:
            range_break_v6 â†’ ~/.local/share/trading25/backtest/optimization/range_break_v6/20250112_143052.html
        """
        from datetime import datetime

        output_dir = f"~/.local/share/trading25/backtest/optimization/{strategy_name}"
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")

        return f"{output_dir}/{timestamp}.html"

    def _generate_visualization_notebook(self, sorted_results: List[Dict]) -> str:
        """
        æœ€é©åŒ–çµæœã‹ã‚‰å¯è¦–åŒ–HTMLã‚’è‡ªå‹•ç”Ÿæˆ

        Args:
            sorted_results: è¤‡åˆã‚¹ã‚³ã‚¢é †ã«ã‚½ãƒ¼ãƒˆã•ã‚ŒãŸæœ€é©åŒ–çµæœ

        Returns:
            str: ç”Ÿæˆã•ã‚ŒãŸHTMLã®ãƒ‘ã‚¹

        ç”Ÿæˆã•ã‚Œã‚‹å¯è¦–åŒ–:
            - è¤‡åˆã‚¹ã‚³ã‚¢ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ï¼ˆä¸Šä½20ä»¶ï¼‰
            - 3Dæ•£å¸ƒå›³ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ vs ã‚¹ã‚³ã‚¢ï¼‰
            - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ„Ÿåº¦åˆ†æï¼ˆãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ï¼‰
            - æŒ‡æ¨™åˆ¥åˆ†å¸ƒå›³ï¼ˆSharpe/Calmar/Returnï¼‰
            - ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç›¸é–¢è¡Œåˆ—
            - æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è©³ç´°è¡¨
        """
        from .notebook_generator import generate_optimization_notebook

        html_path = generate_optimization_notebook(
            results=sorted_results,
            output_path=self.output_html_path,
            strategy_name=self.strategy_name,
            parameter_ranges=self.parameter_ranges,
            scoring_weights=self.optimization["scoring_weights"]
        )

        return html_path

    def _generate_combinations(self) -> List[Dict]:
        """ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµ„ã¿åˆã‚ã›ç”Ÿæˆ"""
        # parameter_rangesã‹ã‚‰ãƒ‡ã‚«ãƒ«ãƒˆç©ã‚’ç”Ÿæˆ
        pass

    def _run_parallel_optimization(
        self,
        combinations: List[Dict]
    ) -> List[Dict]:
        """ä¸¦åˆ—æœ€é©åŒ–å®Ÿè¡Œ"""
        n_jobs = self.optimization["n_jobs"]

        with ProcessPoolExecutor(max_workers=n_jobs) as executor:
            futures = {
                executor.submit(
                    self._evaluate_single_params,
                    combo
                ): combo
                for combo in combinations
            }

            results = []
            for future in tqdm(as_completed(futures), total=len(futures)):
                result = future.result()

                # ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡ºåŠ›
                self._print_progress(result)
                results.append(result)

        return results

    def _evaluate_single_params(self, params: Dict) -> Dict:
        """
        å˜ä¸€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµ„ã¿åˆã‚ã›ã‚’è©•ä¾¡ï¼ˆ2æ®µéšKellyåŸºæº–è©•ä¾¡ï¼‰

        è©•ä¾¡ãƒ—ãƒ­ã‚»ã‚¹:
            1. ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLè¨­å®š + ã‚°ãƒªãƒƒãƒ‰æœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸
            2. åˆå›ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆå…¨éŠ˜æŸ„ç­‰åˆ†é…ï¼‰
            3. KellyåŸºæº–ã«ã‚ˆã‚‹æœ€é©è³‡é‡‘é…åˆ†è¨ˆç®—
            4. Kellyé…åˆ†ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆï¼ˆæœ€çµ‚è©•ä¾¡ï¼‰
        """
        # 1. SignalParamsã‚’å‹•çš„æ§‹ç¯‰ï¼ˆãƒ™ãƒ¼ã‚¹è¨­å®š + æœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
        entry_params = build_signal_params(
            params,
            section="entry_filter_params",
            base_signal_params=self.base_entry_params  # ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLã‹ã‚‰ç¶™æ‰¿
        )
        exit_params = build_signal_params(
            params,
            section="exit_trigger_params",
            base_signal_params=self.base_exit_params  # ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLã‹ã‚‰ç¶™æ‰¿
        )

        # 2. YamlConfigurableStrategyã‚’åˆæœŸåŒ–
        strategy = YamlConfigurableStrategy(
            shared_config=SharedConfig(**self.shared_config),
            entry_filter_params=entry_params,
            exit_trigger_params=exit_params
        )

        # 3. åˆå›ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆç­‰åˆ†é…ï¼‰
        # KellyåŸºæº–è¨ˆç®—ç”¨ã«å…¨éŠ˜æŸ„å‡ç­‰é…åˆ†ã§ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
        portfolio_equal = strategy.run_multi_backtest()

        # 4. KellyåŸºæº–ã«ã‚ˆã‚‹æœ€é©è³‡é‡‘é…åˆ†è¨ˆç®—
        kelly_allocations = strategy.calculate_kelly_allocations(
            portfolio_equal,
            kelly_fraction=self.shared_config["kelly_fraction"]
        )

        # 5. Kellyé…åˆ†ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆæœ€çµ‚è©•ä¾¡ï¼‰
        # æœ€é©é…åˆ†ã§ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚’å†å®Ÿè¡Œ
        portfolio_kelly = strategy.run_multi_backtest(
            custom_allocations=kelly_allocations
        )

        # 6. è©•ä¾¡æŒ‡æ¨™è¨ˆç®—ï¼ˆKellyé…åˆ†çµæœã‚’ä½¿ç”¨ï¼‰
        metrics = self._calculate_metrics(portfolio_kelly, strategy)

        # 7. è¤‡åˆã‚¹ã‚³ã‚¢è¨ˆç®—
        score = self._calculate_composite_score(metrics)

        return {
            "params": params,
            "score": score,
            "metrics": metrics,
            "portfolio": portfolio_kelly,  # Kellyé…åˆ†çµæœã‚’ä¿å­˜
            "kelly_allocations": kelly_allocations  # é…åˆ†æ¯”ç‡ã‚‚ä¿å­˜
        }
```

#### SignalParamsBuilderï¼ˆãƒ™ãƒ¼ã‚¹è¨­å®šãƒãƒ¼ã‚¸æ©Ÿèƒ½ï¼‰

```python
# src/optimization/param_builder.py

def build_signal_params(
    params: Dict,
    section: str,
    base_signal_params: SignalParams
) -> SignalParams:
    """
    ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¾æ›¸ã‹ã‚‰SignalParamsã‚’å‹•çš„æ§‹ç¯‰ï¼ˆãƒ™ãƒ¼ã‚¹è¨­å®šãƒãƒ¼ã‚¸ï¼‰

    è¨­è¨ˆæ€æƒ³:
        - ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLï¼ˆenabled, direction, conditionç­‰ï¼‰ã‚’ç¶™æ‰¿
        - ã‚°ãƒªãƒƒãƒ‰YAMLã§æŒ‡å®šã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ä¸Šæ›¸ã
        - ãã®ä»–ã®è¨­å®šã¯å…¨ã¦ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLã‹ã‚‰å¼•ãç¶™ã

    Args:
        params: {"entry_filter_params.period_breakout.lookback_days": 10, ...}
        section: "entry_filter_params" or "exit_trigger_params"
        base_signal_params: ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLã‹ã‚‰èª­ã¿è¾¼ã‚“ã SignalParams

    Returns:
        SignalParams: ãƒ™ãƒ¼ã‚¹è¨­å®š + æœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒãƒ¼ã‚¸ã—ãŸSignalParams

    Example:
        # ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAML (range_break_v6.yaml)
        entry_filter_params:
          period_breakout:
            enabled: true           # â† ãƒ™ãƒ¼ã‚¹è¨­å®šã‹ã‚‰ç¶™æ‰¿
            direction: "high"       # â† ãƒ™ãƒ¼ã‚¹è¨­å®šã‹ã‚‰ç¶™æ‰¿
            condition: "break"      # â† ãƒ™ãƒ¼ã‚¹è¨­å®šã‹ã‚‰ç¶™æ‰¿
            lookback_days: 10       # â† ã‚°ãƒªãƒƒãƒ‰ã§ä¸Šæ›¸ã
            period: 100             # â† ã‚°ãƒªãƒƒãƒ‰ã§ä¸Šæ›¸ã

        # ã‚°ãƒªãƒƒãƒ‰YAML (range_break_v6_grid.yaml)
        parameter_ranges:
          entry_filter_params:
            period_breakout:
              lookback_days: [5, 10, 15, 20]  # æœ€é©åŒ–å¯¾è±¡
              period: [30, 50, 100, 200]      # æœ€é©åŒ–å¯¾è±¡

        # çµæœ: enabled=True, direction="high", condition="break"ã¯ç¶™æ‰¿
        #       lookback_days=10, period=100ã¯ã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰è¨­å®š
    """
    # 1. ãƒ™ãƒ¼ã‚¹è¨­å®šã‚’dictã«å¤‰æ›ï¼ˆç¶™æ‰¿ç”¨ï¼‰
    base_params_dict = base_signal_params.model_dump()

    # 2. ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŠ½å‡ºï¼ˆã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰æœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ï¼‰
    section_params = {
        k.replace(f"{section}.", ""): v
        for k, v in params.items()
        if k.startswith(f"{section}.")
    }

    # 3. ã‚·ã‚°ãƒŠãƒ«åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
    # {"period_breakout.lookback_days": 10}
    # â†’ {"period_breakout": {"lookback_days": 10}}
    grid_params_dict = {}
    for key, value in section_params.items():
        signal_name, param_name = key.split(".", 1)
        if signal_name not in grid_params_dict:
            grid_params_dict[signal_name] = {}
        grid_params_dict[signal_name][param_name] = value

    # 4. ãƒ™ãƒ¼ã‚¹è¨­å®šã¨ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’ãƒãƒ¼ã‚¸
    merged_params = {}
    for signal_name, base_signal_config in base_params_dict.items():
        if base_signal_config is None:
            continue

        # ãƒ™ãƒ¼ã‚¹è¨­å®šã‚’è¾æ›¸åŒ–
        if hasattr(base_signal_config, "model_dump"):
            base_signal_dict = base_signal_config.model_dump()
        else:
            base_signal_dict = base_signal_config

        # ã‚°ãƒªãƒƒãƒ‰è¨­å®šã§ä¸Šæ›¸ã
        if signal_name in grid_params_dict:
            base_signal_dict.update(grid_params_dict[signal_name])

        merged_params[signal_name] = base_signal_dict

    # 5. SignalParamsæ§‹ç¯‰ï¼ˆãƒãƒ¼ã‚¸çµæœã‹ã‚‰ï¼‰
    kwargs = {}

    # Period Breakout
    if "period_breakout" in merged_params:
        kwargs["period_breakout"] = PeriodBreakoutParams(
            **merged_params["period_breakout"]
        )

    # Bollinger Bands
    if "bollinger_bands" in merged_params:
        kwargs["bollinger_bands"] = BollingerBandsSignalParams(
            **merged_params["bollinger_bands"]
        )

    # Volume
    if "volume" in merged_params:
        kwargs["volume"] = VolumeSignalParams(
            **merged_params["volume"]
        )

    # ... ä»–ã®ã‚·ã‚°ãƒŠãƒ«ã‚‚åŒæ§˜ï¼ˆãƒ™ãƒ¼ã‚¹è¨­å®š + ã‚°ãƒªãƒƒãƒ‰è¨­å®šã‚’ãƒãƒ¼ã‚¸ï¼‰

    return SignalParams(**kwargs)
```

---

## 4. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿

### å¤‰æ›´ãªã—ï¼ˆå®Œå…¨ãªå¾Œæ–¹äº’æ›æ€§ï¼‰

- âœ… `src/strategies/core/yaml_configurable_strategy.py`
- âœ… `src/strategies/signals/processor.py`
- âœ… `src/models/signals.py`
- âœ… å…¨YAMLè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`config/strategies/`ï¼‰

### æ–°è¦è¿½åŠ ã®ã¿

- `src/cli/optimize.py`ï¼ˆæ–°è¦CLIã‚³ãƒãƒ³ãƒ‰ï¼‰
- `src/optimization/`ï¼ˆæ–°è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼‰
  - `engine.py`ï¼ˆæœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³ï¼‰
  - `param_builder.py`ï¼ˆSignalParamså‹•çš„æ§‹ç¯‰ï¼‰
  - `evaluator.py`ï¼ˆè©•ä¾¡æŒ‡æ¨™è¨ˆç®—ï¼‰
  - `notebook_generator.py`ï¼ˆå¯è¦–åŒ–HTMLè‡ªå‹•ç”Ÿæˆï¼‰
- `config/optimization/`ï¼ˆæ–°è¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
- `~/.local/share/trading25/backtest/optimization/`ï¼ˆå¯è¦–åŒ–HTMLå‡ºåŠ›å…ˆãƒ»æˆ¦ç•¥åˆ¥ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
- `docs/parameter-optimization-system.md`ï¼ˆã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰

---

## 5. å®Ÿè£…ä¾‹

### ä¾‹1: SMAã‚¯ãƒ­ã‚¹æˆ¦ç•¥ã®æœ€é©åŒ–

```yaml
# config/optimization/sma_cross_grid.yaml
parameter_ranges:
  entry_filter_params:
    crossover:
      indicator_type: ["sma"]  # å›ºå®š
      short_period: [5, 10, 15, 20]
      long_period: [50, 100, 150, 200]
```

```bash
uv run bt optimize sma_cross
```

### ä¾‹2: BNFå¹³å‡å›å¸°æˆ¦ç•¥ã®æœ€é©åŒ–

```yaml
# config/optimization/bnf_mean_reversion_grid.yaml
parameter_ranges:
  entry_filter_params:
    mean_reversion:
      ma_type: ["sma", "ema"]
      ma_period: [10, 20, 30, 50]
      deviation_threshold: [1.5, 2.0, 2.5]

    rsi_threshold:
      period: [7, 14, 21]
      oversold: [20, 25, 30]
```

```bash
uv run bt optimize bnf_mean_reversion
```

---

## 6. ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¯„å›²ã®è¨­å®š

```yaml
# âŒ æ‚ªã„ä¾‹: æ¥µç«¯ã™ãã‚‹ç¯„å›²
parameter_ranges:
  entry_filter_params:
    period_breakout:
      lookback_days: [1, 2, 3, 500]  # æ¥µç«¯
      period: [5, 10, 1000]  # æ¥µç«¯

# âœ… è‰¯ã„ä¾‹: å¸¸è­˜çš„ãªç¯„å›²
parameter_ranges:
  entry_filter_params:
    period_breakout:
      lookback_days: [5, 10, 15, 20]  # å¦¥å½“
      period: [30, 50, 100, 200]  # å¦¥å½“
```

### æœ€é©åŒ–è¨­å®šã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

æœ€é©åŒ–è¨­å®šï¼ˆä¸¦åˆ—å‡¦ç†æ•°ã€ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é‡ã¿ç­‰ï¼‰ã¯`config/default.yaml`ã§ç®¡ç†ã—ã¾ã™ï¼š

```yaml
# config/default.yaml
default:
  parameters:
    shared_config:
      parameter_optimization:
        enabled: true
        method: "grid_search"  # "grid_search" or "random_search"
        n_jobs: 4  # ä¸¦åˆ—å‡¦ç†æ•°ï¼ˆ-1ã§å…¨CPUã‚³ã‚¢ï¼‰

        # è¤‡åˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°è¨­å®š
        scoring_weights:
          sharpe_ratio: 0.6  # ãƒªã‚¹ã‚¯èª¿æ•´å¾Œãƒªã‚¿ãƒ¼ãƒ³
          calmar_ratio: 0.3  # ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³è€ƒæ…®
          total_return: 0.1  # çµ¶å¯¾ãƒªã‚¿ãƒ¼ãƒ³
```

**è¨­è¨ˆæ€æƒ³**: è¤‡æ•°ã®æŒ‡æ¨™ã‚’çµ„ã¿åˆã‚ã›ãŸè¤‡åˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã«ã‚ˆã‚Šã€ãƒªã‚¹ã‚¯ãƒ»ãƒªã‚¿ãƒ¼ãƒ³ãƒ»ãƒ‰ãƒ­ãƒ¼ãƒ€ã‚¦ãƒ³ã‚’ãƒãƒ©ãƒ³ã‚¹è‰¯ãè©•ä¾¡ã—ã€ãƒ­ãƒã‚¹ãƒˆãªæœ€é©åŒ–ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

---

## 7. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Q1: æœ€é©åŒ–ãŒé…ã„

**åŸå› **: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿çµ„ã¿åˆã‚ã›æ•°ãŒå¤šã„

**è§£æ±ºç­–**: `config/default.yaml`ã§ä¸¦åˆ—å‡¦ç†æ•°ã‚’èª¿æ•´
```yaml
# config/default.yaml
default:
  parameters:
    shared_config:
      parameter_optimization:
        n_jobs: 8  # CPUã‚³ã‚¢æ•°ã«å¿œã˜ã¦ä¸¦åˆ—å‡¦ç†æ•°ã‚’å¢—ã‚„ã™
        max_combinations: 50  # æœ€å¤§çµ„ã¿åˆã‚ã›æ•°ã‚’åˆ¶é™
```

### Q2: æœ€é©ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒTestæœŸé–“ã§æ©Ÿèƒ½ã—ãªã„

**åŸå› **: éå­¦ç¿’ï¼ˆOverfittingï¼‰

**è§£æ±ºç­–**:
- ãƒ‡ãƒ¼ã‚¿åˆ†å‰²ï¼ˆTrain/Testï¼‰ã‚’å¿…ãšè¡Œã†
- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ç¯„å›²ã‚’åºƒã’ã‚‹
- è¤‡åˆã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã§ãƒ­ãƒã‚¹ãƒˆæ€§ã‚’é‡è¦–

---

## 8. ã¾ã¨ã‚

### 2ã¤ã®é‡è¦è¨­è¨ˆåŸå‰‡ï¼ˆå¿…èª­ï¼‰

#### åŸå‰‡1: æˆ¦ç•¥YAML vs ã‚°ãƒªãƒƒãƒ‰YAMLã®è²¬ä»»åˆ†é›¢

**è¨­è¨ˆæ€æƒ³**:
- **æˆ¦ç•¥YAML** (`config/strategies/experimental/range_break_v6.yaml`):
  - âœ… ã‚·ã‚°ãƒŠãƒ«ã®æœ‰åŠ¹åŒ–ï¼ˆ`enabled: true/false`ï¼‰
  - âœ… ã‚·ã‚°ãƒŠãƒ«ã®æ–¹å‘ãƒ»æ¡ä»¶ï¼ˆ`direction`, `condition`ï¼‰
  - âœ… å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆæœ€é©åŒ–ã—ãªã„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰
  - âœ… æˆ¦ç•¥ã®åŸºæœ¬æ§‹é€ ãƒ»ãƒ­ã‚¸ãƒƒã‚¯

- **ã‚°ãƒªãƒƒãƒ‰YAML** (`config/optimization/range_break_v6_grid.yaml`):
  - âœ… **æœ€é©åŒ–å¯¾è±¡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç¯„å›²ã®ã¿**

**å®Ÿè£…ç®‡æ‰€**:
- `ParameterOptimizer.__init__()`: ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLèª­ã¿è¾¼ã¿ï¼ˆlines 308-318ï¼‰
- `build_signal_params()`: ãƒ™ãƒ¼ã‚¹è¨­å®š + ã‚°ãƒªãƒƒãƒ‰è¨­å®šã®ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆlines 543-646ï¼‰
- ãƒãƒ¼ã‚¸ãƒ«ãƒ¼ãƒ«: `enabled`, `direction`, `condition`ç­‰ã¯ãƒ™ãƒ¼ã‚¹æˆ¦ç•¥YAMLã‹ã‚‰ç¶™æ‰¿ã€æœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ã¿ã‚°ãƒªãƒƒãƒ‰YAMLã§ä¸Šæ›¸ã

#### åŸå‰‡2: 2æ®µéšKellyåŸºæº–è©•ä¾¡ãƒ—ãƒ­ã‚»ã‚¹

**è©•ä¾¡ãƒ•ãƒ­ãƒ¼**:
1. **åˆå›ç­‰åˆ†é…ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ**: å…¨éŠ˜æŸ„å‡ç­‰é…åˆ†ã§å®Ÿè¡Œ
2. **KellyåŸºæº–è³‡é‡‘é…åˆ†è¨ˆç®—**: æœŸå¾…ãƒªã‚¿ãƒ¼ãƒ³ãƒ»å‹ç‡ãƒ»ãƒªã‚¹ã‚¯ã‹ã‚‰æœ€é©é…åˆ†æ¯”ç‡ã‚’ç®—å‡º
3. **Kellyé…åˆ†ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ**: æœ€é©é…åˆ†ã§ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆå†å®Ÿè¡Œï¼ˆæœ€çµ‚è©•ä¾¡ï¼‰
4. **è¤‡åˆã‚¹ã‚³ã‚¢è¨ˆç®—**: Kellyé…åˆ†çµæœã‚’ã‚‚ã¨ã«è©•ä¾¡æŒ‡æ¨™ã‚’ç®—å‡º

**å®Ÿè£…ç®‡æ‰€**:
- `_evaluate_single_params()`: 2æ®µéšKellyåŸºæº–è©•ä¾¡ã®å®Œå…¨å®Ÿè£…ï¼ˆlines 478-535ï¼‰
- `run_multi_backtest()`: ç­‰åˆ†é… â†’ Kellyé…åˆ†ã®2å›å®Ÿè¡Œ
- æœ€çµ‚è©•ä¾¡ã¯å¿…ãšKellyé…åˆ†çµæœã‚’ä½¿ç”¨ï¼ˆãƒªã‚¹ã‚¯èª¿æ•´å¾Œã®æœ€é©é…åˆ†ï¼‰

**æ„ç¾©**:
- ç­‰åˆ†é…ã§ã¯è©•ä¾¡ã§ããªã„éŠ˜æŸ„é–“ãƒªã‚¹ã‚¯å·®ã‚’é©åˆ‡ã«åæ˜ 
- ã‚ªãƒ¼ãƒãƒ¼ãƒ•ã‚£ãƒƒãƒ†ã‚£ãƒ³ã‚°é˜²æ­¢ï¼ˆãƒªã‚¹ã‚¯èª¿æ•´å¾Œã®å®‰å®šé…åˆ†ï¼‰
- å®Ÿé‹ç”¨ã«è¿‘ã„è³‡é‡‘é…åˆ†ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–

---

### ã‚·ã‚¹ãƒ†ãƒ ã®ç‰¹å¾´

| é …ç›® | èª¬æ˜ |
|------|------|
| **è¨­è¨ˆæ–¹é‡** | æ—¢å­˜ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Œå…¨ä¿æŒ |
| **è²¬ä»»åˆ†é›¢** | æˆ¦ç•¥YAMLï¼ˆæ§‹é€ ï¼‰vs ã‚°ãƒªãƒƒãƒ‰YAMLï¼ˆæœ€é©åŒ–ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼‰ |
| **KellyåŸºæº–è©•ä¾¡** | 2æ®µéšè©•ä¾¡ï¼ˆç­‰åˆ†é… â†’ Kellyé…åˆ†ï¼‰ã«ã‚ˆã‚‹ãƒªã‚¹ã‚¯èª¿æ•´ |
| **ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å®šç¾©** | YAMLå½¢å¼ï¼ˆå†åˆ©ç”¨æ€§ãƒ»ç®¡ç†æ€§ï¼‰ |
| **å…±é€šè¨­å®šç®¡ç†** | æ—¢å­˜default.yamlã‚’æ´»ç”¨ï¼ˆæ–°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸è¦ï¼‰ |
| **ä¸¦åˆ—å‡¦ç†** | ProcessPoolExecutorï¼ˆé«˜é€ŸåŒ–ï¼‰ |
| **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡ºåŠ›** | é€²æ—ãƒ»è©•ä¾¡æŒ‡æ¨™ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º |
| **å¯è¦–åŒ–** | 3Dæ•£å¸ƒå›³ãƒ»ãƒ’ãƒ¼ãƒˆãƒãƒƒãƒ—ç­‰ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–HTMLè‡ªå‹•ç”Ÿæˆ |
| **ç ´å£Šçš„å¤‰æ›´** | ã‚¼ãƒ­ï¼ˆå®Œå…¨ãªå¾Œæ–¹äº’æ›æ€§ï¼‰ |

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… ã“ã®è¨ˆç”»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç¢ºèªãƒ»æ‰¿èª
2. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚°ãƒªãƒƒãƒ‰YAMLå½¢å¼ã®æœ€çµ‚æ±ºå®š
3. æœ€é©åŒ–ã‚¨ãƒ³ã‚¸ãƒ³å®Ÿè£…
4. CLIã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
5. å¯è¦–åŒ–HTMLè‡ªå‹•ç”Ÿæˆæ©Ÿèƒ½å®Ÿè£…
6. ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼

---

**ğŸš€ ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªæˆ¦ç•¥ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ï¼**

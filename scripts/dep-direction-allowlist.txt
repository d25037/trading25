# Dependency Direction Allowlist — ts→bt references
#
# This file lists apps/ts/ files that are allowed to reference bt server
# (localhost:3002, BT_API_URL, /bt/api/, BacktestClient, etc.)
#
# Rules:
# - New entries require PR comment explaining the reason
# - When a file's bt reference is removed, delete its entry here
# - CI staleness check will fail if an entry no longer matches any pattern
# - Lines starting with # are comments; blank lines are ignored
# - `apps/ts/packages/api` (archived) is excluded from dep-direction scanning

# ─────────────────────────────────────────────────────────
# [permanent] bt:sync tooling — required for OpenAPI schema → TS type generation
# ─────────────────────────────────────────────────────────
apps/ts/packages/shared/scripts/fetch-bt-openapi.ts
# PR #28: bt:sync source-first fallback behavior tests
apps/ts/packages/shared/scripts/fetch-bt-openapi.test.ts
apps/ts/packages/shared/scripts/check-bt-types.ts
apps/ts/packages/shared/src/clients/backtest/generated/type-compatibility-check.ts

# ─────────────────────────────────────────────────────────
# [runtime] apps that intentionally call FastAPI (:3002)
# Keep entries minimal and remove stale references as paths are refactored
# ─────────────────────────────────────────────────────────

# Web components/hooks (still import from @trading25/clients-ts/backtest)
apps/ts/packages/web/src/components/Lab/LabResultSection.tsx
apps/ts/packages/web/src/hooks/useBtOHLCV.ts
apps/ts/packages/web/src/types/backtest.ts

# Vite proxy config (localhost:3002 reference)
apps/ts/packages/web/vite.config.ts

# CLI api-client (localhost:3002 default)
apps/ts/packages/cli/src/utils/api-client.ts

# Shared dataset/fixtures now route via bt FastAPI proxy (:3002)
apps/ts/packages/shared/src/dataset/api-client.ts
apps/ts/packages/shared/src/ta/__fixtures__/fetch-margin-data.ts
apps/ts/packages/shared/src/ta/__fixtures__/fetch-test-data.ts

# CLI backtest commands (BT_API_URL reference)
apps/ts/packages/cli/src/commands/backtest/run.ts
apps/ts/packages/cli/src/commands/backtest/cancel.ts
apps/ts/packages/cli/src/commands/backtest/list.ts
apps/ts/packages/cli/src/commands/backtest/results.ts
apps/ts/packages/cli/src/commands/backtest/status.ts
apps/ts/packages/cli/src/commands/backtest/validate.ts
apps/ts/packages/cli/src/commands/backtest/error-handler.ts
# PR #26: attribution subcommands (use BacktestClient/BT_API_URL)
apps/ts/packages/cli/src/commands/backtest/attribution/run.ts
apps/ts/packages/cli/src/commands/backtest/attribution/status.ts
apps/ts/packages/cli/src/commands/backtest/attribution/results.ts
apps/ts/packages/cli/src/commands/backtest/attribution/cancel.ts
apps/ts/packages/cli/src/commands/backtest/attribution/commands.test.ts

# Canonical client package (Phase 4A)
apps/ts/packages/clients-ts/src/backtest/BacktestClient.ts
apps/ts/packages/clients-ts/src/backtest/BacktestClient.test.ts
apps/ts/packages/clients-ts/src/backtest/index.ts
apps/ts/packages/clients-ts/src/backtest/types.ts
